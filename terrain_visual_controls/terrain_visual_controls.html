<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wave Curves Animation</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #debug {
      position: fixed;
      top: 10px;
      left: 10px;
      color: white;
      font-family: monospace;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div id="debug"></div>
  <script>
    let cols, rows;
    let scale = 20; // èª¿æ•´ç¶²æ ¼å¤§å°
    let w = 1500;
    let h = 1000;
    let flying = 0;
    let terrain = [];
    let debugDiv;
    
    // æ–°å¢žé¡è‰²å’ŒæŽ§åˆ¶åƒæ•¸
    let colorMode = 0; // é¡è‰²æ¨¡å¼
    let amplitude = 250; // æ³¢æµªæŒ¯å¹…
    let noiseScale = 0.15; // å™ªæ³¢æ¯”ä¾‹
    let speed = 0.01; // ç§»å‹•é€Ÿåº¦
    
    // å®šç¾©é¡è‰²ä¸»é¡Œ
    const colorThemes = [
      {base: [50, 100, 255], accent: [150, 200, 255]},  // æµ·æ´‹è—
      {base: [255, 100, 150], accent: [255, 200, 100]}, // å¤•é™½ç´…
      {base: [100, 255, 150], accent: [150, 255, 200]}  // æ£®æž—ç¶ 
    ];

    function setup() {
      createCanvas(windowWidth, windowHeight, WEBGL);
      debugDiv = document.getElementById('debug');
      updateTerrainSize();
      
      // æ·»åŠ å…‰æºæ•ˆæžœ
      lights();
      shininess(20);
      
      // æ·»åŠ éµç›¤äº‹ä»¶ç›£è½
      window.addEventListener('keydown', function(e) {
        e.preventDefault(); // é˜²æ­¢é è¨­è¡Œç‚º
        
        // ä½¿ç”¨ code å±¬æ€§ä¾†è™•ç† Mac éµç›¤äº‹ä»¶
        const code = e.code;
        
        // å»ºç«‹æç¤ºå…ƒç´ 
        const keyPressed = document.createElement('div');
        keyPressed.style.position = 'fixed';
        keyPressed.style.padding = '10px';
        keyPressed.style.background = 'rgba(0,0,0,0.7)';
        keyPressed.style.borderRadius = '5px';
        keyPressed.style.color = 'white';
        keyPressed.style.left = '50%';
        keyPressed.style.top = '20px';
        keyPressed.style.transform = 'translateX(-50%)';
        keyPressed.style.zIndex = '1000';
        keyPressed.style.fontFamily = '-apple-system, system-ui, BlinkMacSystemFont';
        keyPressed.style.fontSize = '14px';
        keyPressed.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
        document.body.appendChild(keyPressed);

        // ä½¿ç”¨ code é€²è¡ŒæŒ‰éµåˆ¤æ–·
        switch(code) {
          case 'KeyC':
            colorMode = (colorMode + 1) % colorThemes.length;
            keyPressed.textContent = `ðŸŽ¨ åˆ‡æ›é¡è‰²ä¸»é¡Œ: ${colorMode + 1}`;
            break;
          case 'ArrowUp':
            amplitude += 10;
            keyPressed.textContent = `â¬†ï¸ å¢žåŠ æ³¢æµªé«˜åº¦: ${amplitude}`;
            break;
          case 'ArrowDown':
            amplitude = Math.max(50, amplitude - 10);
            keyPressed.textContent = `â¬‡ï¸ æ¸›å°‘æ³¢æµªé«˜åº¦: ${amplitude}`;
            break;
          case 'ArrowLeft':
            speed = Math.max(0.001, speed - 0.001);
            keyPressed.textContent = `â¬…ï¸ é™ä½Žé€Ÿåº¦: ${speed.toFixed(3)}`;
            break;
          case 'ArrowRight':
            speed = Math.min(0.02, speed + 0.001);
            keyPressed.textContent = `âž¡ï¸ æé«˜é€Ÿåº¦: ${speed.toFixed(3)}`;
            break;
          default:
            return; // å¦‚æžœä¸æ˜¯æˆ‘å€‘è¦è™•ç†çš„æŒ‰éµï¼Œç›´æŽ¥è¿”å›ž
        }

        // æ’­æ”¾æŒ‰éµéŸ³æ•ˆï¼ˆMac é¢¨æ ¼çš„è¼•é»žè²ï¼‰
        const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA');
        audio.volume = 0.1;
        audio.play().catch(() => {}); // å¿½ç•¥å¯èƒ½çš„è‡ªå‹•æ’­æ”¾é™åˆ¶éŒ¯èª¤
        
        // 2ç§’å¾Œç§»é™¤æç¤º
        setTimeout(() => {
          keyPressed.style.opacity = '0';
          keyPressed.style.transition = 'opacity 0.3s ease-out';
          setTimeout(() => {
            document.body.removeChild(keyPressed);
          }, 300);
        }, 2000);
      });
    }

    function updateTerrainSize() {
      cols = w / scale;
      rows = h / scale;
      terrain = [];
      for (let x = 0; x < cols; x++) {
        terrain[x] = [];
        for (let y = 0; y < rows; y++) {
          terrain[x][y] = 0;
        }
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    function draw() {
      flying -= speed;
      let yoff = flying;

      // æ›´æ–°åœ°å½¢
      for (let y = 0; y < rows; y++) {
        let xoff = 0;
        for (let x = 0; x < cols; x++) {
          terrain[x][y] = map(noise(xoff, yoff), 0, 1, -amplitude, amplitude);
          xoff += noiseScale;
        }
        yoff += noiseScale;
      }

      background(0);
      rotateX(PI / 3);
      translate(-w / 2, -h / 2 - 100);

      // ç¹ªè£½åœ°å½¢
      for (let y = 0; y < rows - 1; y++) {
        beginShape(TRIANGLE_STRIP);
        for (let x = 0; x < cols; x++) {
          const h = terrain[x][y];
          const c = map(h, -amplitude, amplitude, 0, 1);
          
          // ä½¿ç”¨ç•¶å‰é¡è‰²ä¸»é¡Œ
          const theme = colorThemes[colorMode];
          const r = map(c, 0, 1, theme.base[0], theme.accent[0]);
          const g = map(c, 0, 1, theme.base[1], theme.accent[1]);
          const b = map(c, 0, 1, theme.base[2], theme.accent[2]);
          
          fill(r, g, b, 200);
          stroke(r * 0.8, g * 0.8, b * 0.8);
          
          vertex(x * scale, y * scale, terrain[x][y]);
          vertex(x * scale, (y + 1) * scale, terrain[x][y + 1]);
        }
        endShape();
      }

      // æ›´æ–°é™¤éŒ¯è³‡è¨Š
      const debugInfo = `
        FPS: ${frameRate().toFixed(1)}
        è¦–çª—å¤§å°: ${windowWidth} x ${windowHeight}
        åœ°å½¢å¤§å°: ${cols} x ${rows}
        é£›è¡Œå€¼: ${flying.toFixed(2)}
        æŒ¯å¹…: ${amplitude}
        é€Ÿåº¦: ${speed.toFixed(3)}
        é¡è‰²ä¸»é¡Œ: ${colorMode + 1}
        
        æŽ§åˆ¶èªªæ˜Ž:
        C: åˆ‡æ›é¡è‰²ä¸»é¡Œ
        â†‘/â†“: èª¿æ•´æ³¢æµªé«˜åº¦
        â†/â†’: èª¿æ•´é€Ÿåº¦
      `;
      debugDiv.textContent = debugInfo;
    }
  </script>
</body>
</html>
